// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id              String          @id @default(cuid())
  email           String          @unique
  name            String?
  image           String?
  passwordHash    String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  bookmarks       Bookmark[]
  roles           Role[]          @relation("UserRoles")
  founderProfile  FounderProfile?

  // NextAuth fields
  accounts Account[]
  sessions Session[]

  @@map("users")
}

model FounderProfile {
  id                String   @id @default(cuid())
  userId            String   @unique
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Technical Skills (1-5 scale)
  technicalSkills   Int      @default(3)
  designSkills      Int      @default(3)
  marketingSkills   Int      @default(3)
  salesSkills       Int      @default(3)

  // Experience & Background
  industryExperience String? // JSON array of industries
  yearsExperience    Int      @default(0)

  // Personal Attributes
  riskTolerance     Int      @default(3) // 1-5 scale
  timeCommitment    String   @default("part-time") // 'part-time' | 'full-time'
  fundingCapacity   String   @default("bootstrapped") // 'bootstrapped' | 'angel' | 'vc'

  // Preferences
  preferredBuildTypes String? // JSON array
  preferredTags      String?  // JSON array
  avoidTags          String?  // JSON array

  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@map("founder_profiles")
}

model Role {
  id    String @id @default(cuid())
  name  String @unique // 'admin' | 'member'
  users User[] @relation("UserRoles")

  @@map("roles")
}

model Idea {
  id             String     @id @default(cuid())
  slug           String     @unique
  title          String
  summary        String
  problem        String
  solution       String
  targetUser     String?
  whyNow         String?
  difficulty     Int        // 1-5
  buildType      String     // 'SaaS' | 'AI agent' | ...
  tags           String     // JSON string array
  sources        String?    // JSON string
  score          Float      @default(0)
  scoreBreakdown String?    // JSON string
  lastScoredAt   DateTime?

  // Business Metrics & Scores
  opportunityScore    Int?        // 1-10 score
  problemScore        Int?        // 1-10 score
  feasibilityScore    Int?        // 1-10 score
  whyNowScore         Int?        // 1-10 score
  revenuePotential    String?     // e.g., "$1M-$10M ARR"
  executionDifficulty Int?        // 1-10 score
  goToMarketScore     Int?        // 1-10 score

  // Detailed Analysis
  pitch              String?      // Short elevator pitch
  marketGap          String?      // Description of the market gap
  unfairAdvantage    String?      // What gives this idea an edge
  targetMarket       String?      // B2B, B2C, B2B2C
  competitorAnalysis String?      // JSON string

  // Pricing & Offer Structure
  pricingModel       String?      // JSON string - value ladder

  // Execution & Strategy
  executionPlan      String?      // JSON string - steps to execute
  goToMarketStrategy String?      // JSON string - GTM tactics
  mvpTimeline        String?      // e.g., "3-6 months"

  // Market Validation
  proofSignals       String?      // JSON string - evidence of demand
  trendAnalysis      String?      // Why the trend is up/down

  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
  bookmarks      Bookmark[]
  dailyIdeas     DailyIdea[]

  @@map("ideas")
}

model Bookmark {
  id        String   @id @default(cuid())
  userId    String
  ideaId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  idea      Idea     @relation(fields: [ideaId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  @@unique([userId, ideaId])
  @@map("bookmarks")
}

model DailyIdea {
  id     String   @id @default(cuid())
  ideaId String
  idea   Idea     @relation(fields: [ideaId], references: [id], onDelete: Cascade)
  date   DateTime @unique

  @@map("daily_ideas")
}

model Log {
  id        String   @id @default(cuid())
  level     String   // 'info' | 'warning' | 'error'
  message   String
  data      String?  // JSON string
  createdAt DateTime @default(now())

  @@map("logs")
}

// NextAuth models
model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}